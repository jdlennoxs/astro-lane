---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import Layout from "./Layout.astro";
import SectionContainer from "@/components/SectionContainer.astro";
import { Icon } from "astro-icon/components";
import { SITE } from "@config";

export interface Props {
    post: CollectionEntry<"post">;
}

const { post } = Astro.props;

const { title, description, pubDate, updatedDate, heroImage, tags } = post.data;

const ogUrl = new URL(
    heroImage ? heroImage : `${encodeURIComponent(post.slug)}.png`,
    Astro.url.origin
).href;

const { Content, headings } = await post.render();
---

<Layout
    title={`${title} - ${SITE.title}`}
    description={description}
    image={ogUrl}
>
    <article class="w-full">
        <!-- Header Section -->
        <div class="max-w-4xl mx-auto px-4 pt-16 pb-16 text-center">
            <div class="flex flex-wrap justify-center gap-4 mb-6">
                {tags && tags.map((tag) => (
                    <a
                        href={`/tags/${tag.toLowerCase()}`}
                        class={`text-lg text-secondary-600 dark:text-secondary-200 pr-2 flex flex-wrap items-center relative underline hover:text-secondary-900 dark:hover:text-white decoration-secondary-200
                        decoration-2 transition-all duration-300 hover:-translate-y-0.5 focus-visible:p-1`}
                    >
                        <Icon name="tabler:hash" class="w-5 h-5 text-mint-icon" />
                        &nbsp;<span>{tag.toLowerCase()}</span>
                    </a>
                ))}
            </div>
            
            <h1 class="text-3xl md:text-4xl text-text dark:text-cream leading-tight tracking-tighter mb-6 font-body">
                {title}
            </h1>

            <div class="flex items-center justify-center gap-4 text-secondary-500 dark:text-secondary-400 font-sans text-sm">
                <div class="flex items-center gap-2">
                    <span>By {SITE.author}</span>
                </div>
                <span>•</span>
                <FormattedDate date={pubDate} />
                {updatedDate && (
                    <>
                        <span>•</span>
                        <span>Updated <FormattedDate date={updatedDate} /></span>
                    </>
                )}
            </div>
        </div>

        <!-- Hero Image Section Removed -->

        <!-- Main Content Grid -->
        <div class="max-w-screen-xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-12 relative">
            
            <!-- Left Sidebar (TOC) -->
            <div class="hidden lg:block lg:col-span-3">
                <div class="sticky top-24 pr-4 border-secondary-200 dark:border-secondary-800">
                    {headings && headings.length > 0 && (
                        <ul class="space-y-3 text-sm font-sans">
                            {headings.filter((h) => h.depth === 2).map((heading) => (
                                <li>
                                    <a href={`#${heading.slug}`} class="block text-secondary-500 dark:text-secondary-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                        {heading.text}
                                    </a>
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            </div>

            <!-- Content Column -->
            <div class="lg:col-span-7 lg:col-start-4">
                <div class="prose dark:prose-invert max-w-none 
                    prose-headings:font-semibold prose-headings:tracking-tight prose-headings:text-text dark:prose-headings:text-cream prose-headings:scroll-mt-24
                    prose-p:text-secondary-600 dark:prose-p:text-secondary-300 prose-p:leading-relaxed
                    prose-a:font-bold prose-a:underline prose-a:text-text dark:prose-a:text-white hover:prose-a:text-primary-600 dark:hover:prose-a:text-primary-400
                    prose-img:rounded-3xl font-body">
                    <Content />
                </div>
            </div>

            <!-- Right Sidebar (Empty) -->
            <div class="hidden lg:block lg:col-span-2">
            </div>
        </div>
        
        <!-- Mobile TOC / Footer spacing -->
        <div class="h-24"></div>
    </article>
    <script>
      import mermaid from 'mermaid';
      mermaid.initialize({ startOnLoad: true });
    </script>
</Layout>
