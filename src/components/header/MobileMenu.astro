---
import { Icon } from "astro-icon/components";
import planet from "./planet.svg?raw";
import Navigation from "./Navigation.astro";
import ToggleMenu from "./ToggleMenu.astro";
---

<!-- Backdrop overlay -->
<div id="mobile-menu-backdrop" class="fixed inset-0 z-40 bg-black/0 pointer-events-none transition-all duration-300 md:hidden"></div>

<!-- Slide-in menu -->
<div id="mobile-menu" class="fixed inset-0 z-50 -translate-x-full opacity-0 bg-[#f8fafd] transition-all duration-300 ease-out md:hidden">
    <div class="flex h-full flex-col">
        <div class="flex items-center justify-end px-4 py-2 bg-background border-b border-secondary-100 dark:border-secondary-800">
            <ToggleMenu iconName="tabler:x" />
        </div>
        <nav class="flex-1 overflow-y-auto p-4 flex flex-col" aria-label="Mobile navigation">
            <Navigation isMobile={true} />
        </nav>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleButtons = document.querySelectorAll('[data-aw-toggle-menu]');
        const mobileMenu = document.getElementById('mobile-menu');
        const backdrop = document.getElementById('mobile-menu-backdrop');

        function openMenu() {
            if (mobileMenu && backdrop) {
                mobileMenu.classList.remove('-translate-x-full', 'opacity-0');
                mobileMenu.classList.add('translate-x-0', 'opacity-100');
                backdrop.classList.remove('bg-black/0', 'pointer-events-none');
                backdrop.classList.add('bg-black/40', 'pointer-events-auto');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMenu() {
            if (mobileMenu && backdrop) {
                mobileMenu.classList.add('-translate-x-full', 'opacity-0');
                mobileMenu.classList.remove('translate-x-0', 'opacity-100');
                backdrop.classList.add('bg-black/0', 'pointer-events-none');
                backdrop.classList.remove('bg-black/40', 'pointer-events-auto');
                document.body.style.overflow = '';
            }
        }

        function isMenuOpen() {
            return mobileMenu?.classList.contains('translate-x-0');
        }

        if (mobileMenu) {
            toggleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (isMenuOpen()) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });
            });

            // Close on backdrop click
            backdrop?.addEventListener('click', closeMenu);
        }
    });
</script>

